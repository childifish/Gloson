# GLOSON     :pray:å¸Œæœ›äººæ²¡äº‹

ğŸ¤£ä¸çŸ¥é“æ˜¯å¦é«˜æ•ˆä½†åº”è¯¥ä¸é«˜æ•ˆçš„è¶…ç®€é™‹JSONæ¡†æ¶(for golang)ğŸ™‚

ï¼ˆdbqæˆ‘ä¸è¯¥è§‰å¾—jsoæ¡†æ¶ç®€å•ï¼‰

### å®ç°äº†

- ##### ç®€å•JSONçš„ååºåˆ—åŒ–:blush:

  ```go
  	s := "{\n\"name\":\"ç½‘ç«™\",\n\"num\":3,\n\"sites\":[1,2,3]\n}"
  	type AutoGenerated struct {
  		Name  string  `json:"name"`
  		Num   int     `json:"num"`
  		Sites []int64 `json:"sites"`
  	}
  	a := &AutoGenerated{}
  	err := gloson.Bind(s, a)
  	if err == nil {
  		fmt.Printf("%+v", a)
  	}
  ```

  è¾“å‡ºç»“æœä¸º

  ```
  === RUN   Test2
  &{Name:"ç½‘ç«™" Num:3 Sites:[1 2 3]}--- PASS: Test2 (0.00s)
  PASS
  ```

- ##### å¤æ‚JSONçš„ååºåˆ—åŒ–ï¼ˆåµŒå¥—ï¼‰:alien:

  ```go
  	s := "{\n\"GlossDef\": {\n\"para\": \"as DocBook.\",\n\"GlossSeeAlso\":	{par:\"pppapp\",glo:1}\n},\n\"GlossSee\": \"markup\"\n}"
  	type GlossSeeAlso struct {
  		Par string `json:"par"`
  		Glo int    `json:"glo"`
  	}
  	type GlossDef struct {
  		Para         string       `json:"para"`
  		GlossSeeAlso GlossSeeAlso `json:"GlossSeeAlso"`
  	}
  	type AutoGenerated struct {
  		GlossDef GlossDef `json:"GlossDef"`
  		GlossSee string   `json:"GlossSee"`
  	}
  	a := &AutoGenerated{}
  	err := gloson.Bind(s, a)
  	if err == nil {
  		fmt.Printf("%+v", a)
  	}
  ```

  è¾“å‡ºç»“æœä¸º

  ```
  === RUN   TestBind
  &{GlossDef:{Para:"asDocBook." GlossSeeAlso:{Par:"pppapp" Glo:1}} GlossSee:"markup"}--- PASS: TestBind (0.00s)
  PASS
  ```

- ##### ç®€å•JSONçš„åºåˆ—åŒ–:+1:

  ```go
  	type AutoGenerated struct {
  		Name bool      `json:"name"`
  		Num  []float64 `json:"num"`
  		Test []string  `json:"test"`
  	}
  	a := &AutoGenerated{
  		Name: false,
  		Num:  []float64{123120.123, 4.2317823019, 6, 8273},
  		Test: []string{"", "~!!@##$%%^&^&*(){}:}|", "asiojdoa"},
  	}
  	s, _ := gloson.Marshall(a)
  	fmt.Println(s)
  ```

  è¾“å‡ºç»“æœä¸º

  ```
  === RUN   Test5
  {
      "name":false,
      "num":[123120.123, 4.2317823019, 6, 8273],
      "test":["", "~!!@##$%%^&^&*(){}:}|", "asiojdoa"]
  }
  --- PASS: Test5 (0.00s)
  PASS
  ```

- ##### æ¯”è¾ƒå¤æ‚çš„JSONçš„åºåˆ—åŒ–:jack_o_lantern:

  ```go
  type GlossDiv struct {
  		Title2    string `json:"title2"`
  		GlossList int    `json:"GlossList"`
  	}
  	type Glossary struct {
  		Title1   string   `json:"title1"`
  		GlossDiv GlossDiv `json:"GlossDiv"`
  		K        string   `json:"k"`
  	}
  	type AutoGenerated struct {
  		B        int      `json:"b"`
  		Glossary Glossary `json:"Glossary"`
  		C        string   `json:"c"`
  	}
  	a := &AutoGenerated{
  		Glossary: Glossary{
  			GlossDiv: GlossDiv{
  				Title2:    "23333",
  				GlossList: 1,
  			},
  			Title1: "11415",
  			K:      "adsasd",
  		},
  		B: 1,
  		C: "123123",
  	}
  	js := gloson.Marshall(a)
  	fmt.Println(js)
  ```

  è¾“å‡ºç»“æœä¸º

  ```go
  === RUN   TestMarshall3
  {
      "b":1,
      "Glossary":{
          "title1":"11415",
          "GlossDiv":{
              "title2":"23333",
              "GlossList":1,
          },
          "k":"adsasd",
      },
      "c":"123123",
  }
  --- PASS: TestMarshall3 (0.00s)
  PASS
  ```

### :clap:å®ç°è¿‡ç¨‹

#### åºåˆ—åŒ–:v:

- é€šè¿‡åå°„ï¼ˆreflectï¼‰ï¼Œå¯ä»¥è®©æˆ‘ä»¬è§£æä¼ å…¥ç»“æ„ä½“ï¼Œè½»æ¾ï¼ˆå¹¶ä¸ï¼‰åœ°è·å–ç»“æ„ä½“çš„å­—æ®µæ•°ï¼ˆ`.NumField()`ï¼‰ï¼Œtagï¼ˆ`.Tag.Get("json")`ï¼‰ï¼Œç±»å‹ï¼ˆ`.Kind()`ï¼‰

- è·å–è¿™äº›ä¿¡æ¯çš„å‰ææ˜¯`reflect.ValueOf()`å’Œ`reflect.TypeOf()`å…¶ä¸­`reflect.ValueOf()`å¿…é¡»ä»¥æŒ‡é’ˆä¼ é€’

- è·å–ç²¾ç¡®çš„å­—æ®µéœ€è¦`.FieldByIndex()`æˆ–è€…`.Field()`ï¼Œ`.Field()`ç”¨intä¼ å‚ï¼Œ`.FieldByIndex()`ç”¨intæ•°ç»„ï¼Œä¸¤è€…çš„åŒºåˆ«åœ¨äºï¼Œ`.FieldByIndex()`èƒ½å¤Ÿè·å–åµŒå¥—ç»“æ„ä½“å†…çš„æˆå‘˜ï¼Œä¾‹å¦‚ï¼š

  ```go
  type GlossDiv struct {
  		Title2    string `json:"title2"`
  		GlossList int    `json:"GlossList"`
  	}
  	type Glossary struct {
  		Title1   string   `json:"title1"`
  		GlossDiv GlossDiv `json:"GlossDiv"`
  	}
  	type AutoGenerated struct {
  		Glossary Glossary `json:"Glossary"`
  		B        int      `json:"b"`
  	}
  ```

  å°†AutoGeneratedä½œä¸ºä¼ å…¥çš„å‚æ•°ï¼Œå…¶ä¸­è·å–ç¬¬ä¸€ä¸ªæˆå‘˜Glossaryéœ€è¦çš„`.FieldByIndex([]int{0})`ï¼Œè€ŒGlossaryç»“æ„ä½“å†…åµŒåœ¨AutoGeneratedä¸­ï¼ŒGlossaryçš„ç¬¬ä¸€ä¸ªæˆå‘˜Title1å°±æ˜¯`.FieldByIndex([]int{0,0})`,GlossDivé‡Œçš„GlossListåˆ™æ˜¯`.FieldByIndex([]int{0,1,1})`,ä»¥æ­¤ç±»æ¨

- è·å–äº†è¿™äº›ä¿¡æ¯å°±å¯ä»¥è‡ªç”±ç»„åˆäº†ï¼Œåºåˆ—åŒ–è¿™ä¸ªä¸œè¥¿..å› ä¸ºæ˜¯åå†™çš„ï¼Œå‡ºçš„é—®é¢˜ä¸å¤šï¼Œè€Œä¸”ç¡®å®ç®€å•ï¼Œæ„Ÿè§‰æœ‰æ‰‹å°±è¡Œå§ï¼Œæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼ˆåŠ èµ·æ¥ä¹Ÿå°±ä¸€ç™¾å…«åè¡Œï¼‰

- åºåˆ—åŒ–å¤„ç†å¥—å¨ƒçš„å…·ä½“å®ç°éƒ½å†™åœ¨ä»£ç é‡Œäº†

- è™½è¯´èƒ½ç”¨ä½†..

  è¿™æ˜¯è‡ªå¸¦çš„jsonåºåˆ—åŒ–

  ```
  goos: windows
  goarch: amd64
  pkg: gloson/test
  Benchmark2
  Benchmark2-8      857743              1342 ns/op
  PASS
  ```

  è¿™æ˜¯æˆ‘å†™çš„

  ```
  goos: windows
  goarch: amd64
  pkg: gloson/test
  Benchmark
  Benchmark-8        96774             14159 ns/op
  PASS
  ```

  å¤§æ¦‚æœ‰åå€çš„å·®è·

- è€Œç›¸å¯¹ï¼ˆç»å¯¹ï¼‰å›°éš¾çš„æ˜¯ä¸‹é¢çš„...

#### ååºåˆ—åŒ–â€‹â€‹â˜ 

- è¿™æ˜¯æˆ‘å†™çš„

  ```
  goos: windows
  goarch: amd64
  pkg: gloson/test
  Benchmark3
  Benchmark3-8       85110             23466 ns/op
  PASS
  ```

  è¿™ä¸ªæ˜¯è‡ªå¸¦çš„

  ```
  goos: windows
  goarch: amd64
  pkg: gloson/test
  Benchmark3
  Benchmark3-8      923140              1549 ns/op
  PASS
  ```

  å¤§æ¦‚åäº”å€

- ä¸ºä»€ä¹ˆæœ‰è¿™ä¹ˆå¤§çš„å·®è·å‘¢