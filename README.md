# GLOSON     :pray:å¸Œæœ›äººæ²¡äº‹

ğŸ¤£ä¸çŸ¥é“æ˜¯å¦é«˜æ•ˆä½†åº”è¯¥ä¸é«˜æ•ˆçš„è¶…ç®€é™‹JSONæ¡†æ¶(for golang)ğŸ™‚

ï¼ˆdbqæˆ‘ä¸è¯¥è§‰å¾—jsonæ¡†æ¶ç®€å•ï¼‰

## ğŸŒ³å®ç°äº†

- ##### ç®€å•JSONçš„ååºåˆ—åŒ–:blush:

  ```go
  	s := "{\n\"name\":\"ç½‘ç«™\",\n\"num\":3,\n\"sites\":[1,2,3]\n}"
  	type AutoGenerated struct {
  		Name  string  `json:"name"`
  		Num   int     `json:"num"`
  		Sites []int64 `json:"sites"`
  	}
  	a := &AutoGenerated{}
  	err := gloson.Bind(s, a)
  	if err == nil {
  		fmt.Printf("%+v", a)
  	}
  ```

  è¾“å‡ºç»“æœä¸º

  ```
  === RUN   Test2
  &{Name:"ç½‘ç«™" Num:3 Sites:[1 2 3]}--- PASS: Test2 (0.00s)
  PASS
  ```

- ##### å¤æ‚JSONçš„ååºåˆ—åŒ–ï¼ˆåµŒå¥—ï¼‰:alien:

  ```go
  	s := "{\n\"GlossDef\": {\n\"para\": \"as DocBook.\",\n\"GlossSeeAlso\":	{par:\"pppapp\",glo:1}\n},\n\"GlossSee\": \"markup\"\n}"
  	type GlossSeeAlso struct {
  		Par string `json:"par"`
  		Glo int    `json:"glo"`
  	}
  	type GlossDef struct {
  		Para         string       `json:"para"`
  		GlossSeeAlso GlossSeeAlso `json:"GlossSeeAlso"`
  	}
  	type AutoGenerated struct {
  		GlossDef GlossDef `json:"GlossDef"`
  		GlossSee string   `json:"GlossSee"`
  	}
  	a := &AutoGenerated{}
  	err := gloson.Bind(s, a)
  	if err == nil {
  		fmt.Printf("%+v", a)
  	}
  ```

  è¾“å‡ºç»“æœä¸º

  ```
  === RUN   TestBind
  &{GlossDef:{Para:"asDocBook." GlossSeeAlso:{Par:"pppapp" Glo:1}} GlossSee:"markup"}--- PASS: TestBind (0.00s)
  PASS
  ```

- ##### ç®€å•JSONçš„åºåˆ—åŒ–:+1:

  ```go
  	type AutoGenerated struct {
  		Name bool      `json:"name"`
  		Num  []float64 `json:"num"`
  		Test []string  `json:"test"`
  	}
  	a := &AutoGenerated{
  		Name: false,
  		Num:  []float64{123120.123, 4.2317823019, 6, 8273},
  		Test: []string{"", "~!!@##$%%^&^&*(){}:}|", "asiojdoa"},
  	}
  	s, _ := gloson.Marshall(a)
  	fmt.Println(s)
  ```

  è¾“å‡ºç»“æœä¸º

  ```
  === RUN   Test5
  {
      "name":false,
      "num":[123120.123, 4.2317823019, 6, 8273],
      "test":["", "~!!@##$%%^&^&*(){}:}|", "asiojdoa"]
  }
  --- PASS: Test5 (0.00s)
  PASS
  ```

- ##### æ¯”è¾ƒå¤æ‚çš„JSONçš„åºåˆ—åŒ–:jack_o_lantern:

  ```go
  type GlossDiv struct {
  		Title2    string `json:"title2"`
  		GlossList int    `json:"GlossList"`
  	}
  	type Glossary struct {
  		Title1   string   `json:"title1"`
  		GlossDiv GlossDiv `json:"GlossDiv"`
  		K        string   `json:"k"`
  	}
  	type AutoGenerated struct {
  		B        int      `json:"b"`
  		Glossary Glossary `json:"Glossary"`
  		C        string   `json:"c"`
  	}
  	a := &AutoGenerated{
  		Glossary: Glossary{
  			GlossDiv: GlossDiv{
  				Title2:    "23333",
  				GlossList: 1,
  			},
  			Title1: "11415",
  			K:      "adsasd",
  		},
  		B: 1,
  		C: "123123",
  	}
  	js := gloson.Marshall(a)
  	fmt.Println(js)
  ```

  è¾“å‡ºç»“æœä¸º

  ```go
  === RUN   TestMarshall3
  {
      "b":1,
      "Glossary":{
          "title1":"11415",
          "GlossDiv":{
              "title2":"23333",
              "GlossList":1,
          },
          "k":"adsasd",
      },
      "c":"123123",
  }
  --- PASS: TestMarshall3 (0.00s)
  PASS
  ```

## :clap:å®ç°è¿‡ç¨‹

#### åºåˆ—åŒ–:v:

- é€šè¿‡åå°„ï¼ˆreflectï¼‰ï¼Œå¯ä»¥è®©æˆ‘ä»¬è§£æä¼ å…¥ç»“æ„ä½“ï¼Œè½»æ¾ï¼ˆå¹¶ä¸ï¼‰åœ°è·å–ç»“æ„ä½“çš„å­—æ®µæ•°ï¼ˆ`.NumField()`ï¼‰ï¼Œtagï¼ˆ`.Tag.Get("json")`ï¼‰ï¼Œç±»å‹ï¼ˆ`.Kind()`ï¼‰

- è·å–è¿™äº›ä¿¡æ¯çš„å‰ææ˜¯`reflect.ValueOf()`å’Œ`reflect.TypeOf()`å…¶ä¸­`reflect.ValueOf()`å¿…é¡»ä»¥æŒ‡é’ˆä¼ é€’

- è·å–ç²¾ç¡®çš„å­—æ®µéœ€è¦`.FieldByIndex()`æˆ–è€…`.Field()`ï¼Œ`.Field()`ç”¨intä¼ å‚ï¼Œ`.FieldByIndex()`ç”¨intæ•°ç»„ï¼Œä¸¤è€…çš„åŒºåˆ«åœ¨äºï¼Œ`.FieldByIndex()`èƒ½å¤Ÿè·å–åµŒå¥—ç»“æ„ä½“å†…çš„æˆå‘˜ï¼Œä¾‹å¦‚ï¼š

  ```go
  type GlossDiv struct {
  		Title2    string `json:"title2"`
  		GlossList int    `json:"GlossList"`
  	}
  	type Glossary struct {
  		Title1   string   `json:"title1"`
  		GlossDiv GlossDiv `json:"GlossDiv"`
  	}
  	type AutoGenerated struct {
  		Glossary Glossary `json:"Glossary"`
  		B        int      `json:"b"`
  	}
  ```

  å°†AutoGeneratedä½œä¸ºä¼ å…¥çš„å‚æ•°ï¼Œå…¶ä¸­è·å–ç¬¬ä¸€ä¸ªæˆå‘˜Glossaryéœ€è¦çš„`.FieldByIndex([]int{0})`ï¼Œè€ŒGlossaryç»“æ„ä½“å†…åµŒåœ¨AutoGeneratedä¸­ï¼ŒGlossaryçš„ç¬¬ä¸€ä¸ªæˆå‘˜Title1å°±æ˜¯`.FieldByIndex([]int{0,0})`,GlossDivé‡Œçš„GlossListåˆ™æ˜¯`.FieldByIndex([]int{0,1,1})`,ä»¥æ­¤ç±»æ¨

- è·å–äº†è¿™äº›ä¿¡æ¯å°±å¯ä»¥è‡ªç”±ç»„åˆäº†ï¼Œåºåˆ—åŒ–è¿™ä¸ªä¸œè¥¿..å› ä¸ºæ˜¯åå†™çš„ï¼Œå‡ºçš„é—®é¢˜ä¸å¤šï¼Œè€Œä¸”ç¡®å®ç®€å•ï¼Œæ„Ÿè§‰æœ‰æ‰‹å°±è¡Œå§ï¼Œæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼ˆåŠ èµ·æ¥ä¹Ÿå°±ä¸€ç™¾å…«åè¡Œï¼‰

- åºåˆ—åŒ–å¤„ç†å¥—å¨ƒçš„å…·ä½“å®ç°éƒ½å†™åœ¨ä»£ç é‡Œäº†

- è™½è¯´èƒ½ç”¨ä½†..

  è¿™æ˜¯è‡ªå¸¦çš„jsonåºåˆ—åŒ–

  ```
  goos: windows
  goarch: amd64
  pkg: gloson/test
  Benchmark2
  Benchmark2-8      857743              1342 ns/op
  PASS
  ```

  è¿™æ˜¯æˆ‘å†™çš„

  ```
  goos: windows
  goarch: amd64
  pkg: gloson/test
  Benchmark
  Benchmark-8        96774             14159 ns/op
  PASS
  ```

  å¤§æ¦‚æœ‰åå€çš„å·®è·

- è€Œç›¸å¯¹ï¼ˆç»å¯¹ï¼‰å›°éš¾çš„æ˜¯ä¸‹é¢çš„...

#### ååºåˆ—åŒ–â€‹â€‹ğŸ˜¡

- å› ä¸ºå†™ä¹‹å‰æ‹…å¿ƒå¤ªç›¸ä¼¼äº†ï¼Œå°±æ²¡è¯¦ç»†çœ‹jsonååºåˆ—åŒ–å…·ä½“æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œç›´æ¥å°±å¼€å†™äº†

- **å®ç°é€»è¾‘**ï¼šä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œè¿˜æœªååºåˆ—åŒ–çš„jsonï¼ˆstringæˆ–è€…[]byteï¼‰å’Œéœ€è¦ç»‘å®šçš„ç›®æ ‡ç»“æ„ä½“

  1. ä»¥é€—å·ä¸ºæ ‡è¯†ï¼Œå°†å­—ç¬¦ä¸²/[]byteåˆ†å‰²ä¸ºå¤šä¸ªchuck

  2. ä»¥å†’å·ä¸ºæ ‡è¯†ï¼Œå°†æ¯ä¸€ä¸ªchuckåˆ†å‰²ä¸ºKeyå’Œvalueï¼ˆå†’å·å‰å’Œå†’å·åï¼‰ï¼Œå¹¶ä¸”æ ¹æ®valueçš„ç±»å‹ï¼ˆå†’å·åçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œæ¯”å¦‚æ•°å­—æˆ–è€…è´Ÿå·å¼€å¤´ä¸€å®šæ˜¯æ•°å­—ï¼ˆintï¼Œfloatåç»­å†ç»†åˆ†ï¼‰ï¼Œå¼•å·å¼€å¤´æ˜¯å­—ç¬¦ä¸²ï¼Œâ€[â€œå¼€å¤´æ˜¯æ•°ç»„ï¼Œnull,rue,faseè¿™ä¸‰ä¸ªä¸åœ¨â€œâ€ä¸­ï¼Œä¹Ÿå¯ä»¥è¯†åˆ«ï¼‰æ ‡è¯†è¿™ä¸ªchuckï¼Œå†™å…¥ä¸€ä¸ªJsonKVç»“æ„ä½“ä¸­ï¼Œå†å†™å…¥[]JsonKV

     ```go
     type JsonKV struct {
     	Key        string
     	Within     interface{}
     	WithinType string
     }
     ```

  3. ç„¶åè§£æ[]JsonKVï¼Œç”¨ä¸€ä¸ª`CheckType()`å‡½æ•°åˆ¤æ–­ä¹‹å‰å†™å…¥çš„valueï¼ˆJsonKV.Withinï¼‰,ç»“åˆæœ€åˆåˆ†æçš„ç±»å‹ç¡®å®šè¿™ä¸ªvalueçš„å…·ä½“ç±»å‹ï¼Œ

     ï¼ˆå…¶å®è¿™é‡Œå·²ç»å¯ä»¥å¼€å§‹ç€æ‰‹ç»‘å®šç»“æ„ä½“äº†ï¼Œä½†æ˜¯æˆ‘ä¸€å¼€å§‹è„‘å­æ²¡è½¬è¿‡æ¥ï¼Œå¦å¼€äº†ä¸€ä¸ªmap[string]interface{}ï¼Œååºåˆ—åŒ–çš„æ•ˆç‡ç›´æ¥æ— äº†ï¼‰

  4. å°†jsonKVå†™å…¥ä¸€å¼ mapï¼Œå¯¹æœªååºåˆ—åŒ–çš„jsonï¼ˆstringæˆ–è€…[]byteï¼‰çš„æ“ä½œå‘Šä¸€æ®µè½

  5. ç„¶åå¼€å§‹å¯¹éœ€è¦ç»‘å®šçš„ç›®æ ‡ç»“æ„ä½“è¿›è¡Œæ“ä½œï¼Œå’Œåºåˆ—åŒ–çš„æ“ä½œç±»ä¼¼ï¼Œä¹Ÿæ˜¯é€šè¿‡åå°„ï¼ˆreflectï¼‰æ¥è·å–æˆå‘˜çš„ä½ç½®ï¼Œå€¼å’Œtagï¼Œå› ä¸ºæ¶‰åŠåˆ°ç»“æ„ä½“åµŒå¥—çš„é—®é¢˜ï¼Œéœ€è¦ç”¨åˆ°`.FieldByIndex()`ï¼Œè¿™é‡Œæˆ‘ç”¨åˆ°äº†é€’å½’ï¼Œåœ¨è¯»å–åˆ°çš„æˆå‘˜æ˜¯ç»“æ„ä½“æ—¶ï¼Œå°†è¯¥æˆå‘˜çš„ä½ç½®ä½œä¸ºå‚æ•°ä¼ å…¥`FindKeyD()`ï¼Œè¿™æ ·å°±èƒ½è§£æåˆ°å†…å±‚æˆå‘˜äº†

  6. å°†æ¯ä¸ªå­—æ®µçš„åå­—ï¼ˆå› ä¸ºæ¶‰åŠåˆ°æˆå‘˜åç›¸åŒçš„é—®é¢˜ï¼Œè¿™é‡Œç”¨tagè·å–ï¼‰ï¼Œå’Œä½ç½®ï¼Œç±»å‹å†™å…¥ä¸€å¼ map

  7. ç„¶åéå†ä¸¤å¼ mapï¼Œå½“åå­—ç›¸åŒçš„æ—¶å€™ï¼Œå†™å…¥ä¼ å…¥ç»“æ„ä½“ä¸­

  8. èªæ˜çš„å°ä¼™ä¼´å¯èƒ½å‘ç°äº†ï¼Œå¦‚æœæˆ‘å…ˆè§£æç»“æ„ä½“å†è§£æjsonåˆ†å‰²åçš„æ¯ä¸€ä¸ªJsonKV structï¼Œç›´æ¥å°±å¯ä»¥`CheckType()`ç„¶åå†™å…¥ï¼Œåªèƒ½è¯´è¿˜æ˜¯å¤ªå¹´è½»äº†

- æ•ˆç‡æ–¹é¢...è¿™æ˜¯æˆ‘å†™çš„

  ```
  goos: windows
  goarch: amd64
  pkg: gloson/test
  Benchmark3
  Benchmark3-8       85110             23466 ns/op
  PASS
  ```

  è¿™ä¸ªæ˜¯è‡ªå¸¦çš„

  ```
  goos: windows
  goarch: amd64
  pkg: gloson/test
  Benchmark3
  Benchmark3-8      923140              1549 ns/op
  PASS
  ```

  å¤§æ¦‚åäº”å€çš„å·®è·

## ğŸè¿˜æ²¡å®Œå–„çš„ç‚¹

#### åºåˆ—åŒ–ğŸ“ƒ

- jsonåº“çš„åºåˆ—åŒ–è¿˜æ²¡å¼€å§‹çœ‹
- ä¸æ”¯æŒæˆå‘˜ä¸ºç»“æ„ä½“æ•°ç»„çš„åºåˆ—åŒ–
- mapä¹Ÿä¸æ”¯æŒ
- å¸¸è§„çš„æ•°ç»„å¯ä»¥ï¼Œä½†åªæœ‰ä¸‰ç§ï¼ˆstringï¼Œintï¼Œfloat64ï¼‰
- å†™å®Œäº†æ‰å‘ç°æ­£ç¡®çš„jsonæ¯ä¸ªå¯¹è±¡çš„æœ€åä¸€å¯¹key-valueéƒ½æ˜¯æ²¡æœ‰é€—å·çš„
- GG

#### ååºåˆ—åŒ–ğŸ“œ

- jsonåº“çœ‹äº†ä¸€ç‚¹ç‚¹ï¼Œå¤§æ¦‚çŸ¥é“æ˜¯æ€ä¹ˆå®ç°ååºåˆ—åŒ–çš„ï¼ˆç”¨çš„ä¸€ä¸ªdecodeStateç»“æ„ä½“ï¼‰
- return erroréééééå¸¸ä¸å®Œå–„
- ä¸æ”¯æŒå­˜åœ¨ç»“æ„ä½“æ•°ç»„çš„ååºåˆ—åŒ–ï¼ˆå‰åŠéƒ¨åˆ†jsonè§£æåˆ°mapæ˜¯å¯ä»¥çš„ï¼ŒååŠéƒ¨åˆ†è§£æç»“æ„ä½“å†…çš„ç»“æ„ä½“æ•°ç»„è¿˜ä¸è¡Œï¼‰
- æ ·æœ¬å¤ªå°‘äº†ï¼Œç¿»æ¥è¦†å»ç”¨æˆ‘postmané‡Œç•™ä¸‹çš„exampleé‡Œçš„jsonï¼Œéƒ½ç»™è–…ç§ƒäº†
- æµ‹è¯•tagä¸ºä¸­æ–‡æ˜¯å¦å¯è¡Œçš„æ—¶å€™å‘ç°æ•°ç»„é‡Œåªæœ‰ä¸€ä¸ªå…ƒç´ æ—¶æœ‰é—®é¢˜

## ğŸŒˆç¢ç¢å¿µtime

- å—¯ï¼Œå†™ç€å†™ç€å°±è§‰å¾—è‡ªå·±è¿™æ˜¯é¢å‘è„‘æ·¤è¡€çš„ç¼–ç¨‹ï¼Œä¸€ä¸ªå‡½æ•°å†™ä¸‹æ¥æœ‰ä¸€ä¸‡ä¸ªå˜é‡v
- æ²¡æœ‰äº†



#### <--to be continued...